<wxs src="../../../utils/tools.wxs" module="tools" />
<import src="../camera/camera.wxml" />
<template name="posterBottomTool">
  <view class="toolbar-bottom" wx:if="{{menu.mainPageShow==='mainPage'}}">
    <view bindtap='showSecondMenu' data-type="bg" class="item-btn">
      <text class="icon-item iconfont icon-beijingyanse {{menu.menuShow=='bg'?'menu-select':''}}"></text><text class="text {{menu.menuShow=='bg'?'menu-select':''}}">背景</text>
    </view>
    <view bindtap='showSecondMenu' data-type="img" class="item-btn">
      <text class="icon-item iconfont icon-tianjiatupian_huaban {{menu.menuShow=='img'?'menu-select':''}}"></text><text class="text {{menu.menuShow=='img'?'menu-select':''}}">加图</text>
    </view>
    <view bindtap='showSecondMenu' data-type="txt" class="item-btn">
      <text class="icon-item iconfont icon-wenzi {{menu.menuShow=='txt'?'menu-select':''}}"></text><text class="text {{menu.menuShow=='txt'?'menu-select':''}}">加字</text>
    </view>
    <view bindtap='showSecondMenu' data-type="cropper" class="item-btn">
      <text class="icon-item iconfont icon-caijian {{menu.menuShow=='cropper'?'menu-select':''}}"></text><text class="text {{menu.menuShow=='clip'?'menu-select':''}}">裁剪</text>
    </view>
    <view bindtap='showSecondMenu' data-type="doodle" class="item-btn">
      <text class="icon-item iconfont icon-huabi {{menu.menuShow=='doodle'?'menu-select':''}}"></text><text class="text {{menu.menuShow=='doodle'?'menu-select':''}}">涂鸦</text>
    </view>
    <view bindtap='showSecondMenu' data-type="layer" class="item-btn">
      <text class="icon-item iconfont icon-tuceng {{menu.menuShow=='layer'?'menu-select':''}}"></text><text class="text {{menu.menuShow=='layer'?'menu-select':''}}">图层</text>
    </view>
    <view bindtap='showSecondMenu' data-type="sys" class="item-btn">
      <text class="icon-item iconfont icon-xitong- {{menu.menuShow=='sys'?'menu-select':''}}"></text><text class="text {{menu.menuShow=='sys'?'menu-select':''}}">画板</text>
    </view>
  </view>

  <!--背景设置二级菜单-->
  <view class="text-edit-pop edit-pop" wx:if="{{menu.menuShow=='bg'}}">
    <view class="popbg" bindtap="closeTxtEdit" data-type="txt"></view>
    <view class="popup" style="height:57vh;">
      <view class="tab-wapper">
        <view class="tab-item {{menu.isBg=='img'?'select':''}}" bindtap="changeBg" data-type="img">背景图片</view>
        <view class="tab-item {{menu.isBg=='color'?'select':''}}" bindtap="changeBg" data-type="color">背景颜色</view>
      </view>
      <view class="text-background" wx:if="{{menu.isBg=='color'}}">
        <color-picker2  colorData="{{bg.color}}" bindchangecolor="onChangeBgColor"></color-picker2>
        <view class="btn">
          <text class="icon-item iconfont icon-queren1" bindtap="editBgOk"></text>
          <text class="icon-item iconfont icon-quxiao1" bindtap="editBgCancel"></text>
        </view>
      </view>
      <view class='text-background' style="width:300rpx;" wx:else>
        <view class='item-menu' bindtap="getBgPhoto" data-type="album"><text class="iconfont icon-xiangcetupian"></text>相册</view>
        <view class='item-menu' bindtap="getBgPhoto" data-type="camera"><text class="iconfont icon-zhaoxiangji"></text>拍照</view>
        <view class='item-menu' bindtap="getBgPhoto" data-type="talk"><text class="iconfont icon-web-icon-"></text>聊天记录</view>
        <view class='item-menu' bindtap="getBgPhoto" data-type="gallery"><text class="iconfont icon-tuku"></text>图库</view>
        <view class='item-menu' bindtap="getBgPhoto" data-type="cancel"><text class="iconfont icon-quxiao1"></text>取消</view>
      </view>
    </view>
  </view>

  <!--画板操作-->
  <view class="tool-children" style="right:10rpx !important;width:260rpx;" wx:if="{{menu.menuShow=='sys'}}">
    <view class="second-menu">
      <view bindtap="sysSetting" data-type="sys.scale" class="{{menu.secondMenu=='sys.scale' ? 'select' : ''}}">
        <text wx:if="{{scaleStyles.display=='block'}}" class="iconfont icon-guanbixianshi"></text>
        <text wx:else="{{scaleStyles.display=='none'}}" class="iconfont icon-xianshi"></text>
        <text wx:if="{{scaleStyles.display=='block'}}" class="tool_text">隐藏标尺</text>
        <text wx:else="{{scaleStyles.display=='none'}}" class="tool_text">显示标尺</text>
      </view>
      <view bindtap="sysSetting" data-type="sys.save" class="{{menu.secondMenu=='sys.save' ? 'select' : ''}}">
        <text class="iconfont icon-baocun"></text>
        <text class="tool_text">保存</text>
      </view>
      <view bindtap="sysSetting" data-type="sys.clear" class="{{menu.secondMenu=='sys.clear' ? 'select' : ''}}">
        <text class="iconfont icon-delete"></text>
        <text class="tool_text">清空</text>
      </view>
    </view>
  </view>

  <!--加图二级菜单-->
  <view class="tool-children" style="display: {{menu.menuShow=='img' ? 'block' : 'none'}};left:{{menu.menuShowLeft}}rpx;">
    <view class="section-title">
      选择图片:
    </view>
    <!--菜单-->
    <view class="second-menu">
      <view bindtap="getPhotos" data-type="img.album" class="{{menu.secondMenu=='img.album' ? 'select' : ''}}">
        <text class="iconfont icon-xiangcetupian"></text>
        <text class="tool_text">相册</text>
      </view>
      <view bindtap="getPhotos" data-type="img.camera" class="{{menu.secondMenu=='img.camera' ? 'select' : ''}}">
        <text class="iconfont icon-zhaoxiangji"></text>
        <text class="tool_text">拍照</text>
      </view>
      <view bindtap="getPhotos" data-type="img.talk" class="{{menu.secondMenu=='img.talk' ? 'select' : ''}}">
        <text class="iconfont icon-web-icon-"></text>
        <text class="tool_text">聊天</text>
      </view>
      <view bindtap="getPhotos" data-type="img.gallery" class="{{menu.secondMenu=='img.gallery' ? 'select' : ''}}">
        <text class="iconfont icon-tuku"></text>
        <text class="tool_text">图库</text>
      </view>
    </view>
  </view>
  <!--文字编辑层-->
  <view class="text-edit-pop" wx:if="{{menu.menuShow=='txt'}}">
    <view class="popbg" bindtap="closeTxtEdit" data-type="txt"></view>
    <view class="popup" style="height:{{menu.txtPopHeight}}">
      <!--颜色-->
      <view class="color-picker-view" wx:if="{{menu.showColorPicker}}">
        <view class="color-picker-content">
          <color-picker2 colorData="{{menu.colorData.color}}" bindchangecolor="onChangeColor"></color-picker2>
          <text bindtap="closeColorPicker" class="icon-item iconfont icon-queren1"></text>
        </view>
      </view>
      <!-- 字体样式 -->
      <view class="text-edit-css" wx:if="{{menu.secondMenu=='txt.css'}}">
        <view>
          <view class="edit-css-select">
            <text class="label">字体:</text>
            <view class="edit-css-content" bindtap="showFontFamilySelect">
              <block wx:if="{{menu.fontFamilyShowVal=='系统默认字体'}}">
                <text>样例 ABC 123</text>
              </block>
              <block wx:else>
                <text style="font-family:{{menu.fontFamilyShowVal}};">样例 ABC 123</text>
              </block>
              <text class="iconfont {{menu.fontFamilyShow?'icon-shangla':'icon-xiala1'}}" style="color:#5e616d;"></text>
            </view>
          </view>
          <view class="edit-css {{menu.fontFamilyShow ? 'show':'disappear'}}">
            <view wx:for="{{menu.fontFamilySelect}}" wx:key="index" bindtap='selectFontFamily' data-index="{{index}}" class="line {{menu.fontFamilyIndex==index?'checked':''}}">
              <text style="font-family:{{item}};white-space:nowrap;overflow:hidden;">{{item}}</text>
            </view>
          </view>
        </view>
        <view class="eidt-font-size">
          <text class="label">字号:</text>
          <slider class="slider" block-size="15" activeColor="#69a794" bindchange="changeFontSize" min="1" max="100" value="{{itemText.css.fontSize}}" show-value/>
        </view>
        <view class="edit-font-bold">
          <text bindtap="selectFontStyle" data-type='fontWeight#bold' class="iconfont icon-cuti {{itemText.css.fontWeight=='bold'?'checked':''}}">粗体</text>
          <text bindtap="selectFontStyle" data-type='textStyle#italic' class="iconfont icon-zitixieti {{itemText.css.textStyle=='italic'?'checked':''}}">斜体</text>
          <text bindtap="selectFontStyle" data-type='textDecoration#underline' class="iconfont icon-xiahuaxian {{tools.strInclude(itemText.css.textDecoration+'', 'underline')!=-1 ? 'checked' : ''}}">下划线</text>
          <text bindtap="selectFontStyle" data-type='textDecoration#line-through' class="iconfont icon-zitishanchuxian {{tools.strInclude(itemText.css.textDecoration, 'line-through')!=-1 ? 'checked' : ''}}">删除线</text>
          <text bindtap="selectFontStyle" data-type='direction' class="iconfont icon-directionhorizontal {{itemText.css.textVertical==true?'checked':''}}">垂直</text>
          <text bindtap="selectFontStyle" data-type='textAlign#center' class="iconfont icon-juzhong {{itemText.css.textAlign=='center'?'checked':''}}">居中</text>
          <text bindtap="selectFontStyle" data-type='textAlign#left' class="iconfont icon-zuoduiqi {{itemText.css.textAlign=='left'?'checked':''}}">左对齐</text>
          <text bindtap="selectFontStyle" data-type='textAlign#right' class="iconfont icon-youduiqi {{itemText.css.textAlign=='right'?'checked':''}}">右对齐</text>
          <text bindtap="selectFontStyle" data-type='textStyle#stroke' class="iconfont icon-left-text {{itemText.css.textStyle=='stroke'?'checked':''}}">镂空</text>
          <text bindtap="selectFontStyle" data-type='cancel' class="iconfont icon-quxiao1">取消</text>
        </view>
      </view>
      <!-- 背景色 -->
      <view class="text-edit-css" wx:if="{{menu.secondMenu=='txt.background'}}">
        <view>
          <view style="display: flex;flex-direction: row;">
            <text class="input-label">背景色:</text>
            <view>{{itemText.css.background}}</view>
          </view>
          <view class="edit-css-content text-background">
            <color-picker2 colorData="{{menu.backgroundColor.color}}" bindchangecolor="onChangeBackColor"></color-picker2>
          </view>
        </view>
        <view style="display: flex;flex-direction: row; margin-bottom: 20rpx;">
          <text class="input-label">背景色边际与文字间距:</text>
          <input value="{{itemText.css.padding}}"  class="text-input" maxlength="3" type="number" bindinput='paddingInput'/>
        </view>
      </view>
      <!-- 阴影 -->
      <view class="text-edit-css" wx:if="{{menu.secondMenu=='txt.shadow'}}">
        <view>
          <view style="display: flex;flex-direction: row;">
            <text class="input-label">阴影颜色:</text>
            <view>{{itemText.css.shadow}}</view>
          </view>
          <view class="edit-css-content text-background">
            <color-picker2 colorData="{{menu.shadowColor.color}}" bindchangecolor="onChangeShadowColor"></color-picker2>
          </view>
        </view>
        <view style="display: flex;flex-direction: column;align-items: left; margin-bottom: 5rpx;">
          <view style="display: flex;flex-direction:row;margin-bottom: 10rpx;">
            <text class="input-label">阴影水平距离:</text>
            <input value="{{menu.shadowColor.hShadow}}"  class="text-input"  maxlength="2" type="number" bindinput='textShadowInput' data-type="hShadow"/>
          </view>
          <view style="display: flex;flex-direction: row;margin-bottom: 7rpx;">
            <text class="input-label">阴影垂直距离:</text>
            <input value="{{menu.shadowColor.vShadow}}"  class="text-input"  maxlength="2" type="number" bindinput='textShadowInput' data-type="vShadow"/>
          </view>
          <view style="display: flex;flex-direction: row;">
            <text class="input-label">模糊距离:</text>
            <input value="{{menu.shadowColor.blur}}"  class="text-input"  maxlength="2" type="number" bindinput='textShadowInput' data-type="blur"/>
          </view>
        </view>
      </view>
      <view class="edit-pannel" style="display:{{(menu.secondMenu=='txt.edit')?'block':'none'}};">
        <textarea class="input" placeholder="请输入文字" placeholder-class="place-holder" maxlength='120' value="{{item.text}}" bindinput='textAreaInput'/>
      </view>
      <view class="text-edit-menu">
        <view class="item {{menu.secondMenu=='txt.edit'?'select':''}}" bindtap="editText" data-type="txt.edit">
          <text class="iconfont icon-bianji">编辑</text>
        </view>
        <view class="item {{menu.secondMenu=='txt.color'?'select':''}}" bindtap="editText" data-type="txt.color">
          <text class="iconfont icon-yanse" style="color:{{menu.colorData.color}}">颜色</text>
        </view>
        <view class="item {{menu.secondMenu=='txt.css'?'select':''}}" bindtap="editText" data-type="txt.css">
          <text class="iconfont icon--zitiyangshi">样式</text>
        </view>
        <view class="item {{menu.secondMenu=='txt.background'?'select':''}}" bindtap="editText" data-type="txt.background">
          <text class="iconfont icon-beijingse">背景色</text>
        </view>
        <view class="item {{menu.secondMenu=='txt.shadow'?'select':''}}" bindtap="editText" data-type="txt.shadow">
          <text class="iconfont icon-yinying">阴影</text>
        </view>
      </view>
      <view class="btn">
        <text class="icon-item iconfont icon-queren1" bindtap="editTxtOk"></text>
        <text class="icon-item iconfont icon-quxiao1" bindtap="editTxtCancel"></text>
      </view>
    </view>
  </view>
  <!-- 裁剪工具 -->>
  <view class="img-edit-cropper" wx:if="{{menu.menuShow=='cropper'}}">
    <image-cropper id="image-cropper" bindload="cropperload" bindimageload="loadimage" bindtapcut="clickcut" width="{{menu.cropper.width}}" height="{{menu.cropper.height}}" imgSrc="{{menu.cropper.src}}" angle="{{menu.cropper.angle}}" >
    </image-cropper>
    <view class="edit-cropper-foot">
      <view bindtap="cropImg">截图</view>
      <view class="cropper-op">
        <text bindtap='cropLeft' class="iconfont icon-xiangzuosanjiaoxing"></text>
        <view class="cropper-op-mid">
          <text bindtap='cropTop' class="iconfont icon-xiangshangsanjiaoxing"></text>
          <text bindtap='cropBottom' class="iconfont icon-xiangxiasanjiaoxing"></text>
        </view>
        <text bindtap='cropLeft' class="iconfont icon-xiangyousanjiaoxing"></text>
      </view>
      <text bindtap='cropRotateRight' class="iconfont icon-xuanzhuan-2"></text>
      <text bindtap="cropRotateLeft" class="iconfont icon-xuanzhuan-1"></text>
      <text bindtap='cropEnlarge' class="iconfont icon-fangda"></text>
      <text bindtap='cropNarrow' class="iconfont icon-suoxiao"></text>
      <view style="margin-left:25rpx;" bindtap="cropRecover">恢复</view>
    </view>
  </view>
  <!--图层编辑层-->
  <view class="layer-float" wx:if="{{menu.menuShow=='layer'}}">
    <dragSortList id="drag-sort-list" scrollHeight="200" bind:hideItem="dragSortListHideItem" optionList="{{}}">
      
    </dragSortList>
  </view>
  <!--涂鸦编辑层-->
  <view wx:if="{{menu.menuShow=='doodle'}}">
    <doodle id="myDoodleCpt"></doodle>
  </view>
  <!--二级菜单照相功能-->
  <view class="popbg" wx:if="{{menu.carema.showCamera}}" style="z-index: 99999;background: rgba(0, 0, 0, 0.9);">
    <template is="cameraView" data="{{menu}}" />
  </view>
</template>